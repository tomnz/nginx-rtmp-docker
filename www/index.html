<!DOCTYPE html>

<head>
  <title>Glue Hecklevision!</title>
  <link rel="stylesheet" href="https://unpkg.com/video.js@7.7.5/dist/video-js.css" />
  <link rel="stylesheet"
    href="https://unpkg.com/@silvermine/videojs-chromecast@1.2.0/dist/silvermine-videojs-chromecast.css" />
  <link rel="stylesheet"
    href="https://unpkg.com/@silvermine/videojs-airplay@1.0.0/dist/silvermine-videojs-airplay.css" />
  <link rel="stylesheet"
    href="https://unpkg.com/videojs-hls-quality-selector@1.1.1/dist/videojs-hls-quality-selector.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="container">
    <div id="header">
      <h1>Glue Hecklevision!</h1>
      <p>
        To heckle, open The Glue Factory slack, and in any channel, type <code>/heckle</code>, followed
        by the text you want to send.
      </p>
    </div>
    <div id="playerContainer">
      <div id="playerWrapper">
        <video id="video" class="video-js vjs-default-skin">
        </video>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/video.js@7.7.5/dist/video.min.js"></script>
  <script src="https://unpkg.com/@silvermine/videojs-chromecast@1.2.0/dist/silvermine-videojs-chromecast.min.js">
  </script>
  <script>
    window.SILVERMINE_VIDEOJS_CHROMECAST_CONFIG = {
      preloadWebComponents: true,
    };
  </script>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <script src="https://unpkg.com/@silvermine/videojs-airplay@1.0.0/dist/silvermine-videojs-airplay.min.js">
  </script>
  <script src="https://unpkg.com/videojs-contrib-quality-levels@2.0.9/dist/videojs-contrib-quality-levels.min.js">
  </script>
  <script src="https://unpkg.com/videojs-hls-quality-selector@1.1.1/dist/videojs-hls-quality-selector.min.js">
  </script>

  <script lang="text/javascript">
    window.addEventListener('load', () => {
      const options = {
        controls: true,
        preload: 'auto',
        fill: true,
        responsive: true,
        liveui: true,
        techOrder: ['chromecast', 'html5'],
        chromecast: {
          requestTitleFn: () => 'Glue Hecklevision',
        },
        html5: {
          hls: {
            blacklistDuration: 10,
            bandwidth: 1128000,
            useBandwidthFromLocalStorage: true,
            overrideNative: !videojs.browser.IS_ANY_SAFARI,
            smoothQualityChange: true,
          },
          nativeAudioTracks: !videojs.browser.IS_ANY_SAFARI,
          nativeVideoTracks: !videojs.browser.IS_ANY_SAFARI,
        },
        plugins: {
          airPlay: {},
          chromecast: {
            buttonPositionIndex: -2,
            // Glue Cast app
            receiverAppID: 'B42E7286',
          },
        },
        sources: [{
          src: '/live/movie.m3u8',
          type: 'application/vnd.apple.mpegurl',
        }],
      };

      const player = videojs(document.querySelector('#video'), options);
      player.qualityLevels();
      player.hlsQualitySelector({
        displayCurrentQuality: true,
      });

      player.ready(async () => {
        try {
          await player.play();
        } finally {
          // Ignore errors - different browsers handle this in weird ways
        }
      });
    });
  </script>
</body>